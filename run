#!/bin/bash
set -eu -o pipefail

cd "$(dirname "$0")"

if ! command -v bashly &> /dev/null; then
	shopt -s expand_aliases
	alias bashly='docker run --rm -u $(id -u ${USER}):$(id -g ${USER}) --volume "$PWD:/app" dannyben/bashly:0.7.1'
fi

for cmd in src/*_command.sh; do
	(
		echo "# NOTE: This yml file was autogenerated from the '#:' comments in $cmd; DO NOT EDIT."
		echo "#       Modify the script file instead."
		grep -E '^#:' "$cmd" | sed 's%^#: \?%%'
	) > "${cmd/.sh/.yml}"
done

bashly generate --quiet

exec ./git-draft "$@"
